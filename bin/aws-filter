#!/bin/bash

filters=""

while read line
do
	if [ -n "$line" ] &&  ! echo "$line" | grep '^#' &> /dev/null
	then
		comparison="$(echo $line | cut -d' ' -f1)"
		parameter="$(echo $line | cut -d' ' -f2)"
		values="$(echo $line | cut -d' ' -f3-)"
		filters="$filters$parameter=["

		commas="${values//[^,]}"; n=$(( ${#commas} + 1 ))
		for i in $(seq 1 $n)
		do
			filters="$filters{Value=$(echo "$values" | cut -d ',' -f $i),Comparison=$comparison},"
		done
		filters="${filters:0:-1}],"
	fi
done < "$1"

shift

aws "$@" --filters "${filters:0:-1}"
