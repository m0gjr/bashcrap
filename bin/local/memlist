#!/bin/bash

memstat="$(cat /proc/meminfo)"
memtotal="$(echo "$memstat" | grep '^MemTotal:' | awk '{print $2}')"
memavailable="$(echo "$memstat" | grep '^MemAvailable:' | awk '{print $2}')"
swaptotal="$(echo "$memstat" | grep '^SwapTotal:' | awk '{print $2}')"
swapfree="$(echo "$memstat" | grep '^SwapFree:' | awk '{print $2}')"

zfs="$(grep '^size' /proc/spl/kstat/zfs/arcstats 2> /dev/null | awk '{print $3}')"

if [ -z $zfs ]
then
	zfssize=0
else
	zfssize=$(($zfs/1024))
fi

memuse=$(($memtotal-$memavailable-$zfssize))
mem=$((100*$memuse/$memtotal))

swap=$((100-100*$swapfree/$swaptotal))

printf "M: $mem%% S: $swap%%\n"
