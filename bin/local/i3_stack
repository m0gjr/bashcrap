#!/usr/bin/python3

from i3ipc import Event, Connection

def is_floating(container) -> bool:
	if container.floating:
		# We're on i3: on sway it would be None
		# May be 'auto_on' or 'user_on'
		return "_on" in container.floating
	else:
		# We are on sway
		return container.type == "floating_con"


def set_splitting(i3, event) -> None:
	workspace=i3.get_tree().find_focused().workspace()
	tiled_windows = [leaf for leaf in workspace.leaves() if not is_floating(leaf) and not leaf.fullscreen_mode]
	if len(tiled_windows) == 1:
		window = tiled_windows[0]
		window.command("splith")
	elif len(tiled_windows) == 2:
		left, right = tiled_windows
		left.command("splitv")
		right.command("splitv")
		right.command("resize set width 45 ppt")

def set_cursor(i3, event) -> None:
	global old_mode
	new_mode=i3.get_tree().find_focused().fullscreen_mode
	if new_mode != old_mode:
		i3.command("seat * hide_cursor " + str(new_mode*3000))
		old_mode=new_mode

old_mode=0

i3=Connection(auto_reconnect=True)
i3.on(Event.WINDOW_NEW, set_splitting)
i3.on(Event.WINDOW_CLOSE, set_splitting)
i3.on(Event.WINDOW_FULLSCREEN_MODE, set_splitting)
i3.on(Event.WINDOW_FOCUS, set_cursor)
i3.on(Event.WINDOW_FULLSCREEN_MODE, set_cursor)
i3.main()
